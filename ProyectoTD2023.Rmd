---
title: "ProyectoTD2023"
author: "Carlos Gómez Sáez"
date: "2023-04-19"
output: html_document
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Consideraciones

Para verificar el que la importación de datos es correcta usaremos los
datos de la siguiente carpeta:
  './data/1059xlxveei79_ECGf2/27_09_2022/14.42.29_III_ECGyEXTyRESTO/'.

El número de señales que se deben obtener al leer la cabecera digital
son 10

## Fichero 1: "cabecera_FicheroAnalogico.dat"

LEYENDA CABECERA ANALOGICA:
  
  Siguiente orden:
  
  6 datos (uint8_t) con fecha: dia, mes, año, hora, min, seg

1 datos (uint8_t) del ADC: resolucion (bits)

3 datos (int16_t): vmaxADC(mv), vminADC(vm), Fmuestreo(Hz)

```{r}
# Creamos un objeto de conexión para leer el archivo binario usando el modo "rb"
f1 <- file("./data/1059xlxveei79_ECGf2/27_09_2022/14.42.29_III_ECGyEXTyRESTO/cabecera_FicheroAnalogico.dat", "rb")

# Leemos el fichero 
lect1.1 <- readBin(f1, "integer", n = 7, size = 1, signed = F)
lect1.2 <- readBin(f1, "integer", n = 3, size = 2, signed = T)

# Cerramos el fichero 
close(f1)

# Mostramos la información contenida en el fichero 
print('Lectura 1 cabecera fichero Analógico: ')
lect1.1

print('Lectura 2 cabecera fichero Analógico: ')
lect1.2

```

## Fichero 2: "cabecera_FicheroDigital.dat"

LEYENDA CABECERA DIGITAL:
  
  6 datos (uint8_t) con fecha: dia,mes,año,hora,min,seg

2 datos (uint8_t) FM = 4HZ, CANALES = 9

```{r}
# Creamos un objeto de conexión para leer el archivo binario usando el modo "rb"
f2 <- file("./data/1059xlxveei79_ECGf2/27_09_2022/14.42.29_III_ECGyEXTyRESTO/cabecera_FicheroDigital.dat", "rb")

# Leemos el fichero
lect2 <- readBin(f2, "integer", n = 8, size = 1, signed = F)

# Cerramos el fichero 
close(f2)

# Mostramos la información contenida en el fichero 
print(' Lectura cabecera fichero Digital: ')
lect2
```

## Fichero 3: "ficheroAnalogico.dat"

LIBRERÍA NECESARIA: tidyverse

```{r}
# Importamos la librería encesaria:
library(tidyverse)

# Creamos un objeto de conexión para leer el archivo binario usando el modo "rb"
f3 <- file("./data/1059xlxveei79_ECGf2/27_09_2022/14.42.29_III_ECGyEXTyRESTO/ficheroAnalogico.dat", "rb")

# Leemos el fichero
lect3 <- readBin(f3, "integer", n = 1000, size = 2L, signed = T)

# Cerramos el fichero 
close(f3)

# Mostramos la información contenida en el fichero 
print(' Lectura fichero Analógico: ')
lect3

# Establecemos la frecuencia de muestreo del fichero
Fm <- 1000

# Calculamos el eje temporal para el gráfico
t <- seq(0, (length(lect3)-1)/Fm, by = 1/Fm)

# Graficamos los datos
plot(t, lect3, type = "l", col = "black", xlab = "Tiempo (s)", ylab = "Voltaje (mV)")

# Buscamos el voltaaje máximo
vmax <- max(lect3)

# Calculamos el tiempo acorde a las horas, minutos y segundos
hora <- ((length(lect3)/Fm)/60)/60
min <- (hora - hora) * 60
seg <- (min - min) * 60

# Mostramos la duración del registro 
cat(sprintf("Tiempo de registro: %d horas, %d minutos y %d segundos \n", floor(hora), floor(min), floor(seg)))

# Mostramos la frecuencia del registro
cat(sprintf("Frecuencia de muestreo: %i Hz \n", Fm))

# Mostramos el voltaje máximo del registro
cat(sprintf("Voltaje máximo: %d miliVoltios \n", vmax))
```

## Fichero 4: "ficheroDigital.dat"
